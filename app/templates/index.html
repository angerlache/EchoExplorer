<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="../static/css/mystyle.css">


    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <!--script src="{{ url_for('static', filename='js/lib/jquery-2.2.3.min.js') }}" type="text/javascript"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script-->


    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>EchoExplorer</title>
    
    <!--link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"-->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!--link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"-->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <!--script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script-->

    

    <script src="{{ url_for('static', filename='js/lib/wavesurfer.min.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/lib/wavesurfer.spectrogram.min.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/lib/wavesurfer.regions.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/lib/wavesurfer.timeline.min.js') }}" type="text/javascript"></script>
    <!--script src="{{ url_for('static', filename='js/lib/wavesurfer.labels.js') }}" type="text/javascript"></script-->

    <script src="{{ url_for('static', filename='js/lib/d3.v5.min.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/lib/spectrogram.js') }}" type="text/javascript"></script>
    <link href="{{ url_for('static', filename='css/spectrogram.css') }}" media="screen" rel="stylesheet" type="text/css" />

    <!--link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous"-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    

    <!-- Include jquery and css for data table -->
    <link rel="stylesheet" href="https://cdn.datatables.net/2.0.3/css/dataTables.dataTables.css" />
  
    <script src="https://cdn.datatables.net/2.0.3/js/dataTables.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""/>
    
     <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""></script>

</head>
<body>

    <!--button type="button"  onclick="openPopUpWindow()">
        See all species
    </button-->

    <!-- JavaScript function to open the pop-up window -->
    <script>function openPopUpWindow(page) {
                // Specify the properties of the pop-up window
                var popUpProperties = "width=800,height=600,scrollbars=yes,resizable=yes";

                if (page === 'species'){window.open("{{ url_for('species') }}", "Species Window", popUpProperties);}
                else if (page === 'tips') {window.open("{{ url_for('tips') }}", "Tips Window", popUpProperties);}
            }</script>


    <nav class="navbar navbar-dark bg-dark">
    <a class="navbar-brand" href="#"> EchoExplorer </a> <!-- Or other application name -->
    <a class="navbar-brand" href="#" onclick="openPopUpWindow('species')">Species description</a>
    <!--a class="navbar-brand" href="{{url_for('species')}}" onclick="openPopUpWindow()">See all species</a-->
    <a class="navbar-brand" href="{{url_for('login_register')}}">Sign in/up</a>
    {% if is_logged_in %}
        <!-- Show the button only if the user is logged in -->
        <a class="navbar-brand" href="{{url_for('dashboard')}}">Logout Page</a>
        
    {% endif %}
    <!--a class="navbar-brand" href="{{url_for('split')}}" aria-disabled="true">Split Audio</a-->
    <a class="navbar-brand" href="#" onclick="openPopUpWindow('tips')">Usage Tips</a>
    <a class="navbar-brand" href="{{url_for('about')}}">About Us</a>
    <br>
    </nav>
    


    

    <div class="btn-group">

        <div class="btn-group">
            <button type="button" class="btn dropdown-toggle" data-bs-toggle="dropdown" style="font-size: 0.8rem;">File</button>
            <div class="dropdown-menu">
                <button type="button" class="dropdown-item" style="padding: 0rem;">
                    <label class="btn" title="only wav files are supported" for="audioFile" style="text-align: left; width: 100%; font-size: 0.8rem;">Open</label>
                    <input type="file" id="audioFile" accept=".wav" style="display: none;">
                </button>
                <button type="button" class="dropdown-item" style="padding: 0rem;">
                    <label class="btn" for="multipleAudioFile" style="text-align: left; width: 100%; font-size: 0.8rem;">Open multiple</label>
                    <input type="file" id="multipleAudioFile" accept=".wav" multiple style="display: none;">
                </button>
                <button type="button" id="myAudios" class="btn" data-bs-toggle="modal" data-bs-target="#modalAudios" style="text-align: left; width: 100%; font-size: 0.8rem;">
                    My audios
                </button>
                <button type="button" id="allAudios" class="btn" data-bs-toggle="modal" data-bs-target="#modalAudios" style="text-align: left; width: 100%; font-size: 0.8rem;">
                    All audios
                </button>
                <button type="button" id="newObservation" class="btn" data-bs-toggle="modal" data-bs-target="#modalNewObservation" style="text-align: left; width: 100%; font-size: 0.8rem;">
                    New observation
                </button>
            </div>
        </div>
        

        <div class="btn-group">
            <button type="button" id="zoomButton" class="btn dropdown-toggle" data-bs-toggle="dropdown" style="font-size: 0.8rem;">Zoom</button>
            <div class="dropdown-menu">
                <button type="button" id="zoomIn" class="btn dropdown-item" style="font-size: 0.8rem;">Zoom in</button>
                <button type="button" id="zoomOut" class="btn dropdown-item" style="font-size: 0.8rem;">Zoom out</button>
                
                <select id="chunkLengthSelector" class="custom-select" style="text-align: left; width: 100%; font-size: 0.8rem;">
                    <option value="5">5s</option>
                    <option value="10">10s</option>
                    <option value="20">20s</option>
                    <option value="30">30s</option>
                    <option value="60">60s</option>
                </select>
            </div>
        </div>

        <div class="btn-group" id="AIbuttons">
            <button type="button" id="startAI" class="btn dropdown-toggle" data-bs-toggle="dropdown" style="font-size: 0.8rem;" {% if not is_logged_in %} disabled {% endif %}>Process</button>
            <div class="dropdown-menu">
                <button type="button" title="AI for bats" id="processButton" class="btn dropdown-item" style="font-size: 0.8rem;">BatML</button>
                <button type="button" title="AI for birds" id="processButton2" class="btn dropdown-item" style="font-size: 0.8rem;">BirdNET</button>
                <button type="button" title="AI for birds and bats (not the best)" id="processButton3" class="btn dropdown-item" style="font-size: 0.8rem;">BattyBirdNET</button>
            </div>
        </div>


        <div class="btn-group">
            <button type="button" id="optionsButton" class="btn dropdown-toggle" data-bs-toggle="dropdown" style="font-size: 0.8rem;">Options</button>
            <div class="dropdown-menu" style="width: auto;">
                <label style="font-size: 0.8rem;">
                    Max Freq: <input type="range" id="maxFreq" min="4000" max="192000" value="96000"  oninput="this.nextElementSibling.value = this.value + 'Hz'" /> <output id="freqout"> 96000 Hz</output>
                </label>
                <label id="proba-container" style="font-size: 0.8rem;">
                    Classification proba: <input type="range" id="proba-slider" min="0" max="100" value="50"  oninput="this.nextElementSibling.value = this.value + ' %'" /> <output id="probaout">50 %</output>
                </label> 
                <label style="font-size: 0.8rem;"> <input type="checkbox" id="saveAfterAI" checked> Save after AI </label>
            </div>
        </div>

        <div class="btn-group">
            <button type="button" title="check the species you want to display" id="speciesButton" class="btn dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" style="font-size: 0.8rem;">Species</button>
            <ul class="dropdown-menu" id="specyBoxes" aria-labelledby="dropdownCheckSpecies">
                <!--if we want the name of specy not clickable--> 
                <!--li style="font-size: 0.8rem;"> <label> <input type="checkbox" value="Barbarg" checked>  </label> Barbarg </li--> 
                <li> <label style="font-size: 0.8rem;"> <input type="checkbox" value="Barbarg" checked> Barbarg </label> </li> 
                <li> <label style="font-size: 0.8rem;"> <input type="checkbox" value="Envsp" checked> Envsp </label> </li> 
                <li> <label style="font-size: 0.8rem;"> <input type="checkbox" value="Myosp" checked> Myosp </label> </li>
                <li> <label style="font-size: 0.8rem;"> <input type="checkbox" value="Pip35" checked> Pip35 </label> </li> 
                <li> <label style="font-size: 0.8rem;"> <input type="checkbox" value="Pip50" checked> Pip50 </label> </li> 
                <li> <label style="font-size: 0.8rem;"> <input type="checkbox" value="Plesp" checked> Plesp </label> </li> 
                <li> <label style="font-size: 0.8rem;"> <input type="checkbox" value="Rhisp" checked> Rhisp </label> </li> 
                <li> <label title="for birds/bats full names and custom names"  style="font-size: 0.8rem;"> <input type="checkbox" value="other" checked> Others </label> </li> 
                <li> <label title="unannotated regions" style="font-size: 0.8rem;"> <input type="checkbox" value="Region" checked> Region </label> </li> 
                <button type="button" style="text-align: left; width: 100%; font-size: 0.8rem;" class="btn" id="applySpecies">Apply</button>
            </ul> 
        </div>

        <div class="btn-group">
            <button type="button" title="check the AI's you want to show the results" id="aiButton" class="btn dropdown-toggle" aria-expanded="false" data-bs-toggle="dropdown" style="font-size: 0.8rem;">AI</button>
            <ul class="dropdown-menu" id="aiBoxes" aria-labelledby="dropdownCheckAI"> 
                <li> <label style="font-size: 0.8rem;"> <input type="checkbox" value="Human" checked> Human </label> </li> 
                <li> <label style="font-size: 0.8rem;"> <input type="checkbox" value="BatML" checked> BatML </label> </li> 
                <li> <label style="font-size: 0.8rem;"> <input type="checkbox" value="BirdNET" checked> BirdNET </label> </li> 
                <li> <label style="font-size: 0.8rem;"> <input type="checkbox" value="BattyBirdNET" checked> BattyBirdNET </label> </li>
                <button type="button" style="text-align: left; width: 100%; font-size: 0.8rem;" class="btn" id="applyAI">Apply</button>
            </ul> 
        </div>

        <div class="btn-group">
            <button type="button" id="annotationsButton" title="click+drag to create a region&#013;click to annotate&#013;'shift'+click to play&#013;'Ctrl'+click to delete" class="btn dropdown-toggle" data-bs-toggle="dropdown" style="font-size: 0.8rem;">Annotations</button>
            <div class="dropdown-menu">
                <button class="dropdown-item" id="loadLabels" disabled style="font-size: 0.8rem;">Load Local</button>
                <button class="dropdown-item" id="csv" disabled style="font-size: 0.8rem;">Download csv</button>
                <button class="dropdown-item" id="save" disabled style="font-size: 0.8rem;">Save Local</button>
                <button class="dropdown-item" id="uploadButton" style="font-size: 0.8rem;">Share it</button>
                <!--button class="dropdown-item" id="discussButton" {% if not isExpert %}style="display: none;"{% endif %}>Discussed</button-->
                {% if isExpert %}
                    <button class="dropdown-item" id="validateButton" style="font-size: 0.8rem;">Validated</button>
                {% else %}
                    <button class="dropdown-item" id="validateButton" style="display: none; font-size: 0.8rem;">Validated</button>
                {% endif %}
                
            </div>
        </div>      
        
    </div>

    <br>
      
      
    <input type="file" id="audioFile" accept=".wav" style="display: none;">
    <button id="visualizeButton" style="display: none;">Visualize Audio</button>


    <br>

    <div class="container mt-3">
        <div class="alert alert-info" id="tooltip" style="display: none;">
          <strong>Info!</strong> You must be logged in.
        </div>
    </div>

    <div id="waveform"></div>
    <div id="wave-timeline"></div>


    <button id="playButton" disabled> <i class="bi bi-play-fill"></i>/<i class="bi bi-pause-fill"></i> </i></button>

    <button id="prec" title="move backward in the audio"> <i class="bi bi-skip-backward-fill"></i> </button>

    <button id="next" title="move forward in the audio"> <i class="bi bi-skip-forward-fill"></i> </button>


    <label id="slider-container">
        Timestep: <input type="range" id="slider" min="0" max="300" value="0"  oninput="this.nextElementSibling.value = this.value + '/' + this.max + ' seconds'" /> <output id="secout"></output>
    </label>

    
    <!-- The Modal -->
    <div class="modal" id="modalAudios">
        <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
            <div class="modal-body">
                <select id="speciesToSearch" class="custom-select" style="text-align: left; width: 100%; font-size: 0.8rem;">
                    <option value="" selected disabled hidden>Select Species</option>
                    <option value="Barbarg">Barbarg</option>
                    <option value="Envsp">Envsp</option>
                    <option value="Pip35">Pip35</option>
                    <option value="Pip50">Pip50</option>
                    <option value="Rhisp">Rhisp</option>
                    <option value="Plesp">Plesp</option>
                    <option value="Myosp">Myosp</option>
                </select>
                <table id="FilesTable" class="display" style="width:100%;">
                    <thead>
                        <tr>
                            <th>Hash</th>
                            <th>Filename</th>
                            <th>Posted by</th>
                            <th>Duration[s]</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                <div id="mapFiles" style="height: 360px;"></div>

            </div>
    
            <div class="modal-footer">
                <button type="button" id="closeModalAudios" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>
    
        </div>
        </div>
    </div>

    <div class="modal" id="modalNewObservation">
        <div class="modal-dialog modal-fullscreen">
        <div class="modal-content">
    
            <div class="modal-body">
                <button type="button" class="dropdown-item" style="padding: 0rem;">
                    <label class="btn" title="only wav files are supported" for="audioFile" style="text-align: left; width: 100%; font-size: 0.8rem;">Open</label>
                    <input type="file" id="audioFile" accept=".wav" style="display: none;">
                </button>
                <div id="map" style="height: 360px;"></div>
            </div>
    
            <div class="modal-footer">
                <button type="button" id="closeModalNewObservation" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
            </div>
    
        </div>
        </div>
    </div>

    <div id="spectrogram"></div>

    <form role="form" id="myForm" style="display: none;" name="edit" style="opacity: 0; transition: opacity 300ms linear; margin: 30px 0;">
        
        <div>
            <select class="custom-select" id="choiceSelector" name="choiceSelector" style="height: 30px;width: 20%">
                <option value="Barbarg">Barbarg</option>
                <option value="Envsp">Envsp</option>
                <option value="Myosp">Myosp</option>
                <option value="Pip35">Pip35</option>
                <option value="Pip50">Pip50</option>
                <option value="Plesp">Plesp</option>
                <option value="Rhisp">Rhisp</option>
                <option value="other" id="customOption">Custom name (type your own...)</option>
            </select>
        </div>

        <div class="form-group">
            <label for="note">Note</label>
            <textarea id="note" class="form-control" rows="3" name="note" style="width: 20%;"></textarea>
        </div>
        

        <div>
            <button type="submit" class="btn btn-success btn-block">Save</button>
            <button type="button" class="btn btn-secondary btn-block" id="closeForm">Close</button>
        </div>

    </form>


 

    <table id="myTable", class="display" style="width:100%">
        <thead>
            <tr>
                <th>Specie</th>
                <th>Time</th>
                <th>Probability</th>
                <th>AI</th>
                <th>Id</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    
    
       

    <script>
        var userName = "{{ username }}";
        var isLoggedIn = "{{ is_logged_in }}"
        var isExpert = "{{ isExpert }}"
    </script>

    <script src="{{ url_for('static', filename='js/src/main.js') }}" type="module"></script>
    




</body>
</html>
